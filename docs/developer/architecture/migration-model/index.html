<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<title data-react-helmet="true">Migration Model | TruBudget</title><meta data-react-helmet="true" property="og:url" content="https://trubudget.net//docs/developer/architecture/migration-model"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Migration Model | TruBudget"><meta data-react-helmet="true" name="description" content="Date: 28/11/2018"><meta data-react-helmet="true" property="og:description" content="Date: 28/11/2018"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://trubudget.net//docs/developer/architecture/migration-model"><link data-react-helmet="true" rel="alternate" href="https://trubudget.net//docs/developer/architecture/migration-model" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://trubudget.net//docs/developer/architecture/migration-model" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3c7abfd1.css">
<link rel="preload" href="/assets/js/runtime~main.64066931.js" as="script">
<link rel="preload" href="/assets/js/main.13b43359.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">TruBudget</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/README">Documentation</a><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://taas.trubudget.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>TruBudget as a Service<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><b class="navbar__title">TruBudget</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/README">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://taas.trubudget.net" target="_blank" rel="noopener noreferrer" class="menu__link"><span>TruBudget as a Service<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu menu--responsive thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/README">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/usecases">Example Use Cases</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Developer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/introduction">Contributing to TruBudget</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/developer-setup">Setup</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/intro">Architecture Decision Records</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/record-architecture-decisions">Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/access-control-model">Access Control Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/project-data-model">Data model for projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/ressource-level-lifetime">Resource-level lifetime</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/workflowitem-ordering">Workflowitem-ordering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/multi-node-setup">Multi-node setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/execution-architecture-overview">Basic architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/git-branching-model">Git Branching Model</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/developer/architecture/migration-model">Migration Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/multi-node-setup-and-user-management">Multi node setup and user management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/decline-node">Decline Node Request</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/node-connection-info">Node Status</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/logging">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/load-tests">Load and stress tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/documentation">How to write documentation for TruBudget</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Operation / Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/introduction">Introduction and Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/security">Security @ TruBudget</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/README">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Connect to an existing network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/connect-to-an-existing-network/bare-metal">Connect to an existing Blockchain network on Machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/connect-to-an-existing-network/connection-process">Connection Process</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/connect-to-an-existing-network/docker">Connect to an existing Blockchain network using docker</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Create a new network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/create-a-new-network/bare-metal">Create a new Network on a Machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/create-a-new-network/docker">Create a new Network with Docker-Compose</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/encryption">Securing communication between nodes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/logging">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/multichain-cli">Multichain-Cli</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/update-trubudget">Updating TruBudget</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User-Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/README">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">User and groups</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/user">User</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/group">Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/permissions">Permissions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Project</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/project">Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/subproject">Subproject</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/workflowitem">Workflowitems</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/network/nodes">Nodes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Status</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/status/status">Service-Status</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/backup">Backup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/confirmation">Confirmation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/excel-export">Excel Export</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/notifications">Notifications</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Known Issues</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/local">Errors during Local Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/dev">Issues during Developer Setup</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/environment-variables">Environment Variables</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="markdown"><header><h1 class="h1Heading_dC7a">Migration Model</h1></header><p>Date: 28/11/2018</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="status"></a>Status<a class="hash-link" href="#status" title="Direct link to heading">#</a></h2><p>Draft</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="context"></a>Context<a class="hash-link" href="#context" title="Direct link to heading">#</a></h2><p>This ADR discusses how to handle breaking schema changes of the data-model in the context of a distributed application (TruBudget).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="explanation-of-the-current-implementation"></a>Explanation of the current implementation<a class="hash-link" href="#explanation-of-the-current-implementation" title="Direct link to heading">#</a></h3><p>Data is currently stored in streams. A stream contains none, 1, or multiple items. These items can either represent the complete data-set at time of creation or data change (for example an event). In streams that represent the complete data in every item, the last item represents the current state. In streams where items only contain data changes, the items are sourced from the first to the latest in order to get the current state of the data (event-sourcing).</p><p>Items which represent complete data-sets are called <code>Ressource</code>. Items which contain only data changes are called <code>Event</code>.</p><p>In order to be able to change the interface of <code>Event</code> a <code>Event.dataVersion</code> field can be defined describing the interface version of the <code>Event</code>.</p><p>An item of type <code>Ressource</code> currently doesn&#x27;t contain a <code>dataVersion</code> field. Furthermore it is generally using <code>HEX</code> as a dataformat, instead of <code>JSON</code> which is used as dataformat for <code>EVENTS</code> </p><p>For items of type <code>Event</code> the dataVersion is only checked when performing a read requests. When performing a write/publish request to streams containing items from type <code>Event</code> no check is performed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="subject-for-change"></a>Subject for change<a class="hash-link" href="#subject-for-change" title="Direct link to heading">#</a></h3><p>Before the upcoming release we want to unify the dataformats. More precisly the plan is to get rid of the <code>HEX</code> dataformat and only use <code>JSON</code>. Hence, we have to introduce a breaking change regarding in our items of type <code>Ressource</code>. Items created by a node running the new version of Trubudget will be in <code>JSON</code> and can&#x27;t be read by Nodes running an older version of TruBudget (which is expecting <code>HEX</code>).</p><p>For changing the dataformat in the current case there is no technical solution, how to gracefully migrate. Hence, we will do it on an organisational level (updating all versions simultanously).</p><p>But for future updates we want to be better prepared handling version conflicts between different distributed nodes in a TruBudget network.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="options"></a>Options<a class="hash-link" href="#options" title="Direct link to heading">#</a></h3><p>In general we need to distinguish on how data is read from the stream.</p><p>For streams containing items of type <code>Event</code> and doing event-sourcing the newest version needs to be able to read items of older version. If an older version of a node tries to read a stream which contains items of a newer version, it is not able to do so and returns an error.</p><p>For streams containing items of type <code>Ressource</code> only the last element is read. It is pretty much the same: New versions can read stream with items of older versions. But not vice-versa. The only difference is: Since only the last item is read from the stream, old data versions could be migrated resulting in removing source-code which is needed to read the older versions of the item.</p><p>Things get more complicated for write operations:</p><p>For streams containing items of type <code>Event</code> it makes no sense for a node with the old data-version to write, since it might not be able to read it upfront or afterwards.</p><p>For streams containing items of type <code>Ressource</code> it is pretty much the same.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="decision"></a>Decision<a class="hash-link" href="#decision" title="Direct link to heading">#</a></h2><p>Since read and write operation might return errors for nodes running an older dataVersion, these nodes need to be forced to upgrade to a newer version if they still want to participate in the network.</p><p>This means:</p><ul><li>Nodes with older dataVersion are not allowed to write to streams</li><li>Nodes with older dataVersion are allowed to read, but might not be able to get the most recent data</li><li>Items of type <code>Event</code> or <code>Ressource</code> extend a DataVersion interface</li><li>The network is aware of all nodes and it&#x27;s versions (in order to inform them if they run on an old version).</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="todos"></a>TODOs<a class="hash-link" href="#todos" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="change-hex-to-json-format"></a>Change Hex to JSON format<a class="hash-link" href="#change-hex-to-json-format" title="Direct link to heading">#</a></h4><p>Every item, which is written to a stream has <code>JSON</code> as datatype and should extend the <code>DataVersion</code> interface (e.g. <code>Ressource</code>, <code>Event</code>, <code>Vault</code>)</p><p>Use a DataVersion interface for all three interfaces (Event, Resource, Vault)</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface DataVersion {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dataVersion: number</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface Resource extends DataVersion {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">....</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="set-new-version-in-network"></a>Set new version in network<a class="hash-link" href="#set-new-version-in-network" title="Direct link to heading">#</a></h4><p>We create a multichain stream named &quot;versions&quot; where all dataversion should be saved. On startup every node checks its version and updates the stream if it is higher.</p><p>streamname : versions</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  keys: [&quot;1&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    json: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      dataVersion: 1,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      any: [this is a example of the data-format in this version]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="track-versions-in-network"></a>Track versions in network<a class="hash-link" href="#track-versions-in-network" title="Direct link to heading">#</a></h4><p>We currently track all nodes that have been registered in the network. For every node an item is saved to the <code>nodes</code> stream. We also have to save an item if the node&#x27;s dataVersion increases to track versions of every node in the network.</p><p>streamname: nodes
node-address: &quot;1axuNPTudeCHHBwhJD5tYtRaaGWGpkTon5qd&quot;</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;keys&quot; : [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;1axuNPTudeCHHBwhJD5tYtRaaGWGpkTon5qd&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;data&quot; : {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;json&quot; : {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;key&quot; : &quot;1axuNPTudeCHHBwhJD5tYtRaaGWGpkTon5qd&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;intent&quot; : &quot;network.registerNode&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;createdBy&quot; : &quot;&lt;system&gt;&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;createdAt&quot; : &quot;2018-11-12T09:57:19.104Z&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;dataVersion&quot; : 1,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;data&quot; : {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;address&quot; : &quot;1axuNPTudeCHHBwhJD5tYtRaaGWGpkTon5qd&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;organization&quot; : &quot;ACMECorp&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prohibit-writing-with-older-version-when-newer-version-is-set"></a>Prohibit writing with older version when newer version is set<a class="hash-link" href="#prohibit-writing-with-older-version-when-newer-version-is-set" title="Direct link to heading">#</a></h4><p>Before every write operation, the version needs to be checked. The most efficient way to do so is to query the streamkeys with <code>liststreamkeys</code> of the <code>versions</code> stream.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="consequences"></a>Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">#</a></h2><ul><li>an upgraded node might disable all other nodes because nodes with an older version cannot read/write to the multichain in old data-versions</li><li>all items in any stream have a <code>dataVersion</code> field</li><li>version needs to be checked before every write operation</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/developer/architecture/0009-migration-model.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_wj+Z">Last updated on <b><time datetime="2022-08-15T13:35:57.000Z">8/15/2022</time></b> by <b>IngmarM</b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/developer/architecture/git-branching-model"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Git Branching Model</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/developer/architecture/multi-node-setup-and-user-management"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi node setup and user management Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link">Status</a></li><li><a href="#context" class="table-of-contents__link">Context</a><ul><li><a href="#explanation-of-the-current-implementation" class="table-of-contents__link">Explanation of the current implementation</a></li><li><a href="#subject-for-change" class="table-of-contents__link">Subject for change</a></li><li><a href="#options" class="table-of-contents__link">Options</a></li></ul></li><li><a href="#decision" class="table-of-contents__link">Decision</a><ul><li><a href="#todos" class="table-of-contents__link">TODOs</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link">Consequences</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/README">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://taas.trubudget.net" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>TruBudget as a Service<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TruBudget</div></div></div></footer></div>
<script src="/assets/js/runtime~main.64066931.js"></script>
<script src="/assets/js/main.13b43359.js"></script>
</body>
</html>