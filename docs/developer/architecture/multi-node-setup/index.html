<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="search" type="application/opensearchdescription+xml" title="TruBudget" href="/opensearch.xml"><title data-react-helmet="true">Multi-node setup | TruBudget</title><meta data-react-helmet="true" property="og:url" content="https://trubudget.net//docs/developer/architecture/multi-node-setup"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Multi-node setup | TruBudget"><meta data-react-helmet="true" name="description" content="Date: 05/07/2018"><meta data-react-helmet="true" property="og:description" content="Date: 05/07/2018"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://trubudget.net//docs/developer/architecture/multi-node-setup"><link data-react-helmet="true" rel="alternate" href="https://trubudget.net//docs/developer/architecture/multi-node-setup" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://trubudget.net//docs/developer/architecture/multi-node-setup" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://asdas-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.fe657d06.css">
<link rel="preload" href="/assets/js/runtime~main.9dba0609.js" as="script">
<link rel="preload" href="/assets/js/main.2e1a65c5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">TruBudget</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/README">Documentation</a><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><b class="navbar__title">TruBudget</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/README">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/README">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/usecases">Example Use Cases</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Developer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/introduction">Contributing to TruBudget</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/developer-setup">Setup</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/intro">Architecture Decision Records</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/record-architecture-decisions">Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/access-control-model">Access Control Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/project-data-model">Data model for projects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/ressource-level-lifetime">Resource-level lifetime</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/workflowitem-ordering">Workflowitem-ordering</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/developer/architecture/multi-node-setup">Multi-node setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/execution-architecture-overview">Basic architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/git-branching-model">Git Branching Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/migration-model">Migration Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/multi-node-setup-and-user-management">Multi node setup and user management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/decline-node">Decline Node Request</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/architecture/node-connection-info">Node Status</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/logging">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/load-tests">Load and stress tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer/documentation">How to write documentation for TruBudget</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Operation / Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/introduction">Introduction and Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/security">Security @ TruBudget</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/README">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Connect to an existing network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/connect-to-existing-node/bare-metal">Connect to an Existing Network on Bare Metal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/connect-to-existing-node/connect-docker-compose">Connect to an Existing Network using Docker</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Create a new network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/create-new-network/bare-metal">Create a New Network Directly on Machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/installation/create-new-network/create-new-docker-compose">Create a New Network with Docker-Compose</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/encryption">Securing communication between nodes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/logging">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/multichain-cli">Multichain-Cli</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/operation-administration/update-trubudget">Updateing TruBudget</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User-Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/README">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">User and groups</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/user">User</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/group">Group</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/users-and-groups/permissions">Permissions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Project</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/project">Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/subproject">Subproject</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/projects/workflowitem">Workflowitems</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/network/nodes">Nodes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Status</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/status/status">Service-Status</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/backup">Backup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/confirmation">Confirmation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/excel-export">Excel Export</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user-guide/notifications">Notifications</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Known Issues</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/local">Errors during Local Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/dev">Issues during Developer Setup</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/enviroment-variables">Environment Variables</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/environment-variables">Environment Variables</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Multi-node setup</h1></header><p>Date: 05/07/2018</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="status"></a>Status<a class="hash-link" href="#status" title="Direct link to heading">#</a></h2><p>Superceded by <a href="/docs/developer/architecture/0010-multi-node-setup-and-user-management">multi node setup</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="context"></a>Context<a class="hash-link" href="#context" title="Direct link to heading">#</a></h2><p>Even though Multichain (like Bitcoin) has to be bootstrapped from a single node, we&#x27;re aiming at a system design that doesn&#x27;t rely on a single party being involved in most administrative tasks, such as adding additional nodes to an existing deployment.</p><p>This ADR discusses terminology and setup of the TruBudget network.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="decision"></a>Decision<a class="hash-link" href="#decision" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="terminology"></a>Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">#</a></h3><p>Each <em>node</em> is associated to a single <em>organization</em> (e.g. ACMECorp, UmbrellaCorp), including the special <em>origin node</em>, which mines the first block in the network. Nodes that belong to the same organization are called <em>internal peers</em>; nodes that belong to other organizations are called <em>external peers</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="blockchain-addresses"></a>Blockchain Addresses<a class="hash-link" href="#blockchain-addresses" title="Direct link to heading">#</a></h3><p>User authenticate themselves using username and password, but internally every user is assigned a blockchain address, along with a public and a secret key. On the chain, each action is then associated with the user&#x27;s key and the associated permissions, which makes operations secure and auditing reliable.</p><p>With Multichain, each node owns a unique address, generated when started the first time (its wallet address). In day-to-day operations, those addresses are not used and only the address of the first node of an organization is put on the chain (and thus propagated among nodes).</p><p>By mining the genesis block (that is, the first block in the network), the origin node gets <em>full</em> permissions on <em>everything</em>, which includes exclusive access to the <code>root</code> stream. The permissions are bound to the origin-node&#x27;s address; we call the associated key <em>origin root key</em> (ORK). The ORK is not put on the chain and should be backed up by the administrator; it is also not used in day-to-day operations. Instead, the ORK is used to create another node address that holds necessary permissions; that key is called <em>organization key</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="distributing-secret-keys"></a>Distributing secret keys<a class="hash-link" href="#distributing-secret-keys" title="Direct link to heading">#</a></h3><p>The organization key is put on the chain, into a stream-item on the organization&#x27;s stream, called the <em>vault</em>. The vault holds the private keys of all (technical and non-technical) users of the organization. In order to prevent other organizations from using them, the vault needs to be encrypted. The encryption key is a shared secret known to all internal peers, called the <em>organization vault secret</em> (OVS). Whenever <del>the vault is updated, all internal peers import new keys into their wallet (using a walletnotify script)</del> a user logs in, the user&#x27;s private key is read from the vault and imported into the node&#x27;s wallet, which allows users to move freely between their organization&#x27;s nodes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="joining-the-network"></a>Joining the network<a class="hash-link" href="#joining-the-network" title="Direct link to heading">#</a></h3><p>There are two ways an organization can join the network:</p><ol><li>The organization maintains the origin node, in which case the ORK is used to create the organization key (see above).</li><li>For all other organizations, the first node needs to connect to any node of an organization that has <em>trusted access</em> (see below).</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="trusted-vs-managed-access"></a>Trusted vs. managed access<a class="hash-link" href="#trusted-vs-managed-access" title="Direct link to heading">#</a></h4><p>In the TruBudget network, there are two types of organizational access to the network: <em>admin</em> and <em>basic</em>. The main difference is that with admin the node can also <em>mine</em> and write to so-called &quot;admin&quot; streams. In TruBudget, each organization should have exactly one address (the <em>organization address</em>) with admin permissions; all other node addresses should have basic access only. This ensures that a single organization cannot manipulate the network without other organizations noticing.</p><p>In other words, connecting as a new organization <strong>B</strong> to an existing TruBudget network of organization <strong>A</strong> works as follows:</p><ol><li><strong>A</strong> gives <strong>B</strong> the API URL of any one of their nodes.</li><li><strong>B</strong> runs TruBudget for the first time, pointing it to the given URL. Since the instance address is unknown to <strong>A</strong>&#x27;s node, the connection fails; instead, the administrator of <strong>A</strong> will see the connection request in TruBudget&#x27;s connection dashboard. Meanwhile, the node of <strong>B</strong> continues its connection attempts.</li><li>The administrator of <strong>A</strong> verifies the address by calling <strong>B</strong>, asking them for confirmation. The administrator then chooses &quot;trusted access&quot; for the connection request. The address of the node of <strong>B</strong> is now <strong>B</strong>&#x27;s organization key.</li><li>Now that the <code>connect</code> permission has been granted, <strong>B</strong>&#x27;s node is finally able to establish a connection, joining the network and fetching all existing data in the process. Since the organization stream for <strong>B</strong> is not yet present, the node infers it&#x27;s <strong>B</strong>&#x27;s first node; consequently, the node creates the organization stream and initializes the &quot;vault&quot; stream-item with its encrypted private key (= organization key).</li></ol><p>With managed access, the connecting organization cannot execute the last step itself.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly mermaid"><pre tabindex="0" class="prism-code language-mermaid codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sequenceDiagram</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">participant A as Orga A (trusted access)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">participant B as Orga B, node 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">participant B2 as Orga B, node 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B-&gt;&gt;A:connect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A-&gt;&gt;A:Multichain: B has no connect permission</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A-&gt;&gt;A:Add connection attempt to dashboard</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A--&gt;&gt;B:connection denied!</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A-&gt;&gt;A:Admin validates the address, approves &quot;trusted access&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B-&gt;&gt;A:connect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A-&gt;&gt;A:Multichain: B has connect permission</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">A--&gt;&gt;B:connection established!</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B-&gt;&gt;B:Initialize own organization stream</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B-&gt;&gt;B:Encrypt own private key with vault key and set as vault</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B2-&gt;&gt;B:connect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">note over B,B2:same procedure, except node 2 uses existing organization stream and doesn&#x27;t add own private key to vault (it imports the existing one instead).</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="user-management"></a>User Management<a class="hash-link" href="#user-management" title="Direct link to heading">#</a></h3><p><code>N Users &lt;-&gt; 1 Organization</code></p><p>As mentioned above, each organization&#x27;s users have their addresses and private keys stored in the organization&#x27;s vault, which is encrypted using the organization vault secret (OVS). The OVS is initialized using the <code>VAULT_SECRET</code> environment variable.</p><p>Consequently, all client-related operations are only possible on nodes that have the right OVS set in their environment (typically equal to the nodes that belong to the same organization as the requesting user):</p><ul><li>user creation, as it directly modifies the vault</li><li>authentication, since it causes the user&#x27;s private key to be imported in the node&#x27;s wallet, which in turn requires read access to the vault</li><li>all other API calls, as the token is always augmented with the user&#x27;s private key, which requires read access to the vault</li></ul><p>To ease testing (and because it doesn&#x27;t affect production), a node always tries to decrypt the vault that belongs to the user&#x27;s organization, without checking first whether it belongs to that organization itself. A node always belongs to a single organization, but using the same OVSs for all organizations enables a node to cater all API requests (not to be done in production, because then all nodes have all keys of all users of all organizations in their wallet, basically circumventing all other security mechanisms).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="consequences"></a>Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">#</a></h2><p>This ADR describes the general idea behind the setup.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/developer/architecture/0006-multi-node-setup.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2022-02-07T11:50:04.000Z">2/7/2022</time></b> by <b>Stezido</b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/developer/architecture/workflowitem-ordering"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Workflowitem-ordering</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/developer/architecture/execution-architecture-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Basic architecture overview Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link">Status</a></li><li><a href="#context" class="table-of-contents__link">Context</a></li><li><a href="#decision" class="table-of-contents__link">Decision</a><ul><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#blockchain-addresses" class="table-of-contents__link">Blockchain Addresses</a></li><li><a href="#distributing-secret-keys" class="table-of-contents__link">Distributing secret keys</a></li><li><a href="#joining-the-network" class="table-of-contents__link">Joining the network</a></li><li><a href="#user-management" class="table-of-contents__link">User Management</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link">Consequences</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/README">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkfw/TruBudget/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openkfw/TruBudget" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TruBudget</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9dba0609.js"></script>
<script src="/assets/js/main.2e1a65c5.js"></script>
</body>
</html>