(self.webpackChunkweb=self.webpackChunkweb||[]).push([[4414],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return u}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(n),u=a,k=m["".concat(l,".").concat(u)]||m[u]||d[u]||r;return n?o.createElement(k,i(i({ref:t},p),{},{components:n})):o.createElement(k,i({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2466:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var o=n(2122),a=n(9756),r=(n(7294),n(3905)),i=["components"],s={},l="Create a New Network with Docker-Compose",c={unversionedId:"operation-administration/installation/create-new-network/create-new-docker-compose",id:"operation-administration/installation/create-new-network/create-new-docker-compose",isDocsHomePage:!1,title:"Create a New Network with Docker-Compose",description:"This guide describes how to start a new instance of Trubudget using docker-compose.",source:"@site/docs/operation-administration/installation/create-new-network/create-new-docker-compose.md",sourceDirName:"operation-administration/installation/create-new-network",slug:"/operation-administration/installation/create-new-network/create-new-docker-compose",permalink:"/trubudget-website/docs/operation-administration/installation/create-new-network/create-new-docker-compose",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/operation-administration/installation/create-new-network/create-new-docker-compose.md",version:"current",lastUpdatedBy:"Stefan Ziffer",lastUpdatedAt:1632418294,formattedLastUpdatedAt:"9/23/2021",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create a New Network Directly on Machine",permalink:"/trubudget-website/docs/operation-administration/installation/create-new-network/bare-metal"},next:{title:"Securing communication between nodes",permalink:"/trubudget-website/docs/operation-administration/encryption"}},p=[{value:"Table of Contents",id:"table-of-contents",children:[]},{value:"Prerequisites",id:"prerequisites",children:[{value:"Docker &amp; Docker Compose",id:"docker--docker-compose",children:[]},{value:"Ports",id:"ports",children:[]},{value:"Verify version",id:"verify-version",children:[]},{value:"Clean installation",id:"clean-installation",children:[]}]},{value:"Create a new Blockchain network",id:"create-a-new-blockchain-network",children:[]}],d={toc:p};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"create-a-new-network-with-docker-compose"},"Create a New Network with Docker-Compose"),(0,r.kt)("p",null,"This guide describes how to start a new instance of Trubudget using docker-compose."),(0,r.kt)("p",null,"We distinguish between two types of deployments:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("strong",{parentName:"li"},"local")," deployment type which will create images from the code you have on your local machine and includes any changes you might have done"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("strong",{parentName:"li"},"master")," deployment type that will deploy Docker images out of the Docker Hub")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For the master deployment, you can use tags to specify the version you want to use"))),(0,r.kt)("p",null,"The deployments are abstracted through shell scripts. We expect you to have a UNIX-like operating system which can execute shell scripts, e.g. Ubuntu. If not, take a look at the scripts and port them according to your operating system."),(0,r.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-new-network-with-docker-compose"},"Create a New Network with Docker-Compose"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#table-of-contents"},"Table of Contents")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#prerequisites"},"Prerequisites"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#docker--docker-compose"},"Docker & Docker Compose")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ports"},"Ports")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#verify-version"},"Verify version")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#clean-installation"},"Clean installation")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#create-a-new-blockchain-network"},"Create a new Blockchain network"))))),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"docker--docker-compose"},"Docker & Docker Compose"),(0,r.kt)("p",null,"The whole deployment is based on Docker and Docker Compose, therefore please follow the instructions on how to setup ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/installation/"},"Docker")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/install/#install-compose"},"Docker Compose")," (find an Ubuntu-related guide ",(0,r.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04"},"here"),")."),(0,r.kt)("p",null,"You need at least docker engine version 17.06."),(0,r.kt)("h3",{id:"ports"},"Ports"),(0,r.kt)("p",null,"Make sure that the following ports are not blocked by other processes: ",(0,r.kt)("inlineCode",{parentName:"p"},"80"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"8080"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"8081"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"7447"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"7448")),(0,r.kt)("h3",{id:"verify-version"},"Verify version"),(0,r.kt)("p",null,"Start with checking out the repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/openkfw/TruBudget\ncd TruBudget\n")),(0,r.kt)("p",null,"This will create a local copy of the source code in a folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"TruBudget")," (= your local checkout)."),(0,r.kt)("p",null,"If you work with an existing checkout, make sure you have the latest changes:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git pull\n")),(0,r.kt)("p",null,"In order to pull the images from the Docker Hub, you need to be logged in with your Docker credentials."),(0,r.kt)("h3",{id:"clean-installation"},"Clean installation"),(0,r.kt)("p",null,"If you have previously started a TruBudget instance and want to start a new Blockchain network without previously stored data, remove the Docker volumes with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm -r /tmp/bc*\n")),(0,r.kt)("p",null,"If this is either your first time starting TruBudget or you want to resume where you left off, skip this step."),(0,r.kt)("h2",{id:"create-a-new-blockchain-network"},"Create a new Blockchain network"),(0,r.kt)("p",null,"Each Blockchain container comes with its own volume that persists the data of the Blockchain.\nTo modify the host path, meaning the path where the data will be persisted on your local machine, navigate to the docker-compose file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker-compose/master/master-node.yml\n")),(0,r.kt)("p",null,"If you want to run the network with your local sources, update the volume in the following file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose/local/master-node.yml\n")),(0,r.kt)("p",null,"Currently both Blockchain containers store their data in ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp/bc*")," directories. This works fine for testing, but ",(0,r.kt)("em",{parentName:"p"},"should not be used in productive environments")," since the ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp/")," folder is emptied after reboot on most Unix-like systems."),(0,r.kt)("p",null,"Adapt the paths to your needs - you can change them in the respective docker-compose file, where you will find them under ",(0,r.kt)("inlineCode",{parentName:"p"},"volumes"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"volumes:\n  - /tmp/bcMasterVolume:/root/.multichain\n")),(0,r.kt)("p",null,"The next step is to set all required environment properties, otherwise Docker will not receive the required parameters to start the deployment.\nIf you want to start with the standard configuration we reccomend copying the ",(0,r.kt)("inlineCode",{parentName:"p"},".env_example")," file and rename it to ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TruBudget")," base folder:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cp .env_example .env\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file to create a new Blockchain network should consist of the following parameters:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'API_PORT=8080\nRPC_PORT=8000\nORGANIZATION=TheOrganization\nORGANIZATION_VAULT_SECRET=secret\nTAG=master\nROOT_SECRET=root-secret\nLOG_LEVEL=INFO\nPRETTY_PRINT=true\nRPC_PASSWORD=s750SiJnj50yIrmwxPnEdSzpfGlTAHzhaUwgqKeb0G1j\nMULTICHAIN_DIR="/root"\nEXTERNAL_IP=\n')),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For detailed explenations of the environment variables, see the ",(0,r.kt)("a",{parentName:"p",href:"/trubudget-website/docs/enviroment-variables"},"Enviroment Variables")))),(0,r.kt)("p",null,"To deploy the ",(0,r.kt)("strong",{parentName:"p"},"current codebase")," of the repository with an empty blockchain, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scripts/local/start-master-node.sh\n")),(0,r.kt)("p",null,"Deploy images ",(0,r.kt)("strong",{parentName:"p"},"of the Docker registry")," with an empty blockchain with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scripts/master/start-master-node.sh\n")),(0,r.kt)("p",null,"If you want to start with a fixed set of projects, subprojects, workflowitems and users, you can start a so called 'provisioned blockchain' for master development with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scripts/master/start-and-provision-master-node.sh\n")),(0,r.kt)("p",null,"or for local development with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"scripts/local/start-and-provision-master-node.sh\n")),(0,r.kt)("p",null,"Once all components are up and running, the information after provisioning in the log should look similar to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'testapi_1         | POST /api/workflowitem.intent.grantPermission [user=mstein body={"apiVersion":"1.0","data":{"projectId":"2ac3cfed87f243c7ef05f8d3aff3e656","subprojectId":"b829cb0de28d621435ed5e66fe16255f","workflowitemId":"1d734c6c12f1d5e2cd112856ea39ae1e","intent":"workflowitem.update","identity":"rfinance"}}]\ntestapi_1         | Publishing workflowitem.intent.grantPermission to 2ac3cfed87f243c7ef05f8d3aff3e656/["b829cb0de28d621435ed5e66fe16255f_workflows","1d734c6c12f1d5e2cd112856ea39ae1e"]\ntestapi_1         |\ntestapi_1         | POST /api/workflowitem.intent.grantPermission [user=mstein body={"apiVersion":"1.0","data":{"projectId":"2ac3cfed87f243c7ef05f8d3aff3e656","subprojectId":"b829cb0de28d621435ed5e66fe16255f","workflowitemId":"1d734c6c12f1d5e2cd112856ea39ae1e","intent":"workflowitem.intent.listPermissions","identity":"atutelle"}}]\ntestapi_1         | Publishing workflowitem.intent.grantPermission to 2ac3cfed87f243c7ef05f8d3aff3e656/["b829cb0de28d621435ed5e66fe16255f_workflows","1d734c6c12f1d5e2cd112856ea39ae1e"]\ntestapi_1         |\ntestapi_1         | POST /api/workflowitem.intent.grantPermission [user=mstein body={"apiVersion":"1.0","data":{"projectId":"2ac3cfed87f243c7ef05f8d3aff3e656","subprojectId":"b829cb0de28d621435ed5e66fe16255f","workflowitemId":"1d734c6c12f1d5e2cd112856ea39ae1e","intent":"workflowitem.intent.grantPermission","identity":"atutelle"}}]\ntestapi_1         | Publishing workflowitem.intent.grantPermission to 2ac3cfed87f243c7ef05f8d3aff3e656/["b829cb0de28d621435ed5e66fe16255f_workflows","1d734c6c12f1d5e2cd112856ea39ae1e"]\ntestapi_1         |\ntestapi_1         | POST /api/workflowitem.intent.grantPermission [user=mstein body={"apiVersion":"1.0","data":{"projectId":"2ac3cfed87f243c7ef05f8d3aff3e656","subprojectId":"b829cb0de28d621435ed5e66fe16255f","workflowitemId":"1d734c6c12f1d5e2cd112856ea39ae1e","intent":"workflowitem.intent.revokePermission","identity":"atutelle"}}]\ntestapi_1         | Publishing workflowitem.intent.grantPermission to 2ac3cfed87f243c7ef05f8d3aff3e656/["b829cb0de28d621435ed5e66fe16255f_workflows","1d734c6c12f1d5e2cd112856ea39ae1e"]\nprovision-test_1  | Subproject "Primary School" > "Equipment" created.\nprovision-test_1  | Project "Primary School" created.\ntrubudget_provision-test_1 exited with code 0\n')),(0,r.kt)("p",null,"No need to worry regarding the provisioning container. Both provisioning containers (provision-test, provision-prod) will exit with ",(0,r.kt)("strong",{parentName:"p"},"error code 0")," once the network was successfully provisioned."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"frontend")," should be accessible via port 80 on the server that it is running on."))}m.isMDXComponent=!0}}]);