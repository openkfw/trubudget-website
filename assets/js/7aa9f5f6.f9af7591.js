"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[84181],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||r;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8695:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const r={},i="Create a new Network with Docker-Compose",l={unversionedId:"operation-administration/installation/create-a-new-network/docker",id:"operation-administration/installation/create-a-new-network/docker",title:"Create a new Network with Docker-Compose",description:"This guide describes how to start a new instance of Trubudget using docker-compose.",source:"@site/docs/operation-administration/installation/create-a-new-network/docker.md",sourceDirName:"operation-administration/installation/create-a-new-network",slug:"/operation-administration/installation/create-a-new-network/docker",permalink:"/docs/operation-administration/installation/create-a-new-network/docker",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/operation-administration/installation/create-a-new-network/docker.md",tags:[],version:"current",lastUpdatedBy:"egdmrsy",lastUpdatedAt:1687938884,formattedLastUpdatedAt:"Jun 28, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create a new Network on a Machine",permalink:"/docs/operation-administration/installation/create-a-new-network/bare-metal"},next:{title:"Architecture in TruBudget",permalink:"/docs/operation-administration/architecture"}},s={},p=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Docker &amp; Docker Compose",id:"docker--docker-compose",level:3},{value:"Ports and IP Addresses for TruBudget",id:"ports-and-ip-addresses-for-trubudget",level:3},{value:"Verify version of TruBudget",id:"verify-version-of-trubudget",level:3},{value:"Clean installation",id:"clean-installation",level:3},{value:"Create a new Blockchain network",id:"create-a-new-blockchain-network",level:2},{value:"Create a new Blockchain network with two organization",id:"create-a-new-blockchain-network-with-two-organization",level:2},{value:"Example",id:"example",level:3}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"create-a-new-network-with-docker-compose"},"Create a new Network with Docker-Compose"),(0,o.kt)("p",null,"This guide describes how to start a new instance of Trubudget using docker-compose."),(0,o.kt)("p",null,"We distinguish between two types of deployments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"local")," deployment type which will create images from the code you have on your local machine and includes any\nchanges you might have done"),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"alpha")," deployment type that will deploy Docker images out of the Docker Hub")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For the alpha deployment, you can use tags to specify the version you want to use")),(0,o.kt)("p",null,"The deployments are abstracted through shell scripts. We expect you to have a UNIX-like operating system which can\nexecute shell scripts, e.g. Ubuntu. If not, take a look at the scripts and port them according to your operating system."),(0,o.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#create-a-new-network-with-docker-compose"},"Create a new Network with Docker-Compose"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#table-of-contents"},"Table of Contents")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#prerequisites"},"Prerequisites"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#docker--docker-compose"},"Docker & Docker Compose")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#ports-and-ip-addresses-for-trubudget"},"Ports and IP Addresses for TruBudget")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#verify-version-of-trubudget"},"Verify version of TruBudget")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#clean-installation"},"Clean installation")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#create-a-new-blockchain-network"},"Create a new Blockchain network")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#create-a-new-blockchain-network-with-two-organization"},"Create a new Blockchain network with two organization"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#example"},"Example"))))))),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("h3",{id:"docker--docker-compose"},"Docker & Docker Compose"),(0,o.kt)("p",null,"The whole deployment is based on Docker and Docker Compose, therefore you need to\ninstall ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/community-edition#/download"},"Docker")," (version 20.10.7 or higher)\nand ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/install/"},"Docker Compose")," (version 1.29.2 or higher)."),(0,o.kt)("h3",{id:"ports-and-ip-addresses-for-trubudget"},"Ports and IP Addresses for TruBudget"),(0,o.kt)("p",null,"Make sure that the following ports are not blocked by other processes: ",(0,o.kt)("inlineCode",{parentName:"p"},"3000"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"8080"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"8090"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"9000"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"8081"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"7447"),"\n, ",(0,o.kt)("inlineCode",{parentName:"p"},"7448"),".\nAlso make sure that IPv4 subnet mask ",(0,o.kt)("inlineCode",{parentName:"p"},"172.21.0.0/24")," is free to use on your computer."),(0,o.kt)("p",null,"If the subnet mask or some ports are already used by other processes or programs, you can easily change the port in\nthe ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file that is located in ",(0,o.kt)("inlineCode",{parentName:"p"},"/scripts/operations/"),"."),(0,o.kt)("h3",{id:"verify-version-of-trubudget"},"Verify version of TruBudget"),(0,o.kt)("p",null,"Start with checking out the repository:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/openkfw/TruBudget\ncd TruBudget\n")),(0,o.kt)("p",null,"This will create a local copy of the latest source code in a folder called ",(0,o.kt)("inlineCode",{parentName:"p"},"TruBudget")," (= your local checkout)."),(0,o.kt)("p",null,"If you work with an existing checkout, make sure you have the latest changes:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git checkout main\ngit pull\n")),(0,o.kt)("h3",{id:"clean-installation"},"Clean installation"),(0,o.kt)("p",null,"If you have previously started a TruBudget instance and want to start a new Blockchain network without previously stored\ndata, remove the Docker volumes with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo rm -r /alphaVolume\nsudo rm -r /beta1Volume\nsudo rm -r /minioVolume\nsudo rm -r /emaildbVolume\n")),(0,o.kt)("p",null,"If this is either your first time starting TruBudget or you want to resume where you left off, skip this step."),(0,o.kt)("h2",{id:"create-a-new-blockchain-network"},"Create a new Blockchain network"),(0,o.kt)("p",null,"Each Blockchain container comes with its own volume that persists the data of the Blockchain.\nTo modify the host path, meaning the path where the data will be persisted on your local machine (docker volume), you\ncan change it in the docker-compose file ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts/operation/docker-compose.yml"),"."),(0,o.kt)("p",null,"The next step is to set all required environment properties, otherwise Docker will not receive the required parameters\nto start the deployment.\nIf you want to start with the standard configuration we recommend copying the ",(0,o.kt)("inlineCode",{parentName:"p"},".env_example")," file and rename it\nto ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"TruBudget")," base folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd scripts/operation/\ncp .env_example .env\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," in scripts/operation/ can be edited directly to fit your needs."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For detailed explanations of the environment variables, see\nthe ",(0,o.kt)("a",{parentName:"p",href:"./../../../environment-variables"},"Environment Variables"))),(0,o.kt)("p",null,"To start the TruBudget in an easy way, use the bash script ",(0,o.kt)("inlineCode",{parentName:"p"},"start-trubudget.sh"),"."),(0,o.kt)("p",null,"If you want to start a setup with one blockchain, frontend, API and provisioning (for test data), run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd scripts/operation/\nbash start-trubudget.sh --slim\n")),(0,o.kt)("p",null,"If you want to add an additional blockchain node, email-notification-service, excel-export-service or storage-service,\nplease take a look at\nthe ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openkfw/TruBudget/blob/main/scripts/operation/README.md#trubudget-operation-setup"},"README.md of operation setup")),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"frontend")," should be accessible via port 3000 on the server that it is running on: http://localhost:3000/"),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"API Swagger documentation")," should be accessible via port 8080 on the server that it is running\non: http://localhost:8080/api/documentation/static/index.html"),(0,o.kt)("h2",{id:"create-a-new-blockchain-network-with-two-organization"},"Create a new Blockchain network with two organization"),(0,o.kt)("p",null,"To connect two blockchains, you need to define exactly one alpha node and one or more beta nodes. The define a beta\nnode, you must set the\ncorrect ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openkfw/TruBudget/blob/main/blockchain/README.md#environment-variables"},"Environmental variables"),"\nin a blockchain node in order to"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"start a beta node with correct environmental variables"),(0,o.kt)("li",{parentName:"ol"},"send access requests to the alpha node")),(0,o.kt)("p",null,"To understand how to set the environment variables correctly,\nread ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openkfw/TruBudget/blob/main/docs/operation-administration/installation/connect-to-an-existing-network/docker.md"},"How to connect to a alpha node"),"\n."),(0,o.kt)("p",null,"If you want to know what exactly happens when blockchain nodes are connecting, read the description of\nthe ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openkfw/TruBudget/blob/main/blockchain/README.md#Lifecycle"},"Lifecycle"),"."),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"The docker-compose file in ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts/operation/")," comes with one additional blockchain node (beta-node) that tries to\nconnect to the alpha node after starting.\nEach Blockchain container comes with its own volume that persists the data of the Blockchain."),(0,o.kt)("p",null,"To start TruBudget with two organizations (alpha and beta), run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"bash start-trubudget.sh --slim --add-organization\n")),(0,o.kt)("p",null,"This will create the blockchain, API and frontend for each of both organizations.\nYou can access the frontend of the beta-node with http://localhost:3005/ and the for the alpha-node\nwith http://localhost:3000/. This is defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file.\nThe beta-node must be approved by the alpha-node. This can be done with the root user in the alpha frontend at the\npage http://localhost:3000/nodes.\nThe name of both organization and other configurations are defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file (in the\ndirectory ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts/operation/"),")."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you need more beta-nodes, you have to change the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file and ",(0,o.kt)("inlineCode",{parentName:"p"},"start-trubudget.sh")," in the\ndirectory ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts/operation/")," by yourself.")))}u.isMDXComponent=!0}}]);